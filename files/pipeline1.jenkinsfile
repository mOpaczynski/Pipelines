pipeline {
  agent any
  options {
    disableConcurrentBuilds()
  }
  stages {
    stage('Build solution') {
      steps {
        powershell ".\\build.ps1 -Target Build-Solution"
      }
    }
    stage('Run unit tests') {
      steps {
        powershell ".\\build.ps1 -Target Run-Unit-Tests"
      }
    }
    post {
      always {
        nunit healthScaleFactor: 10.0, testResultsPattern: 'TestResult.xml'
      }
    }
    stage('Test database migrations') {
      steps {
		    powershell ".\\build.ps1 -Target Migrate-Databases-And-Test-Seeds"
      }
    }
    stage('Run tests') {
      parallel {
        stage('API tests'){
          steps{
            echo 'Running api...'
            echo 'Running api...'
            echo 'Running api...'
          }
        }
        stage("UI tests"){
          steps{
            echo 'Running ui...'
            echo 'Running ui...'
            echo 'Running ui...'
          }
        }
      }
    }
    stage('Deploy') {
      steps {
        echo 'Deploying...'
      }
    }
  }
}